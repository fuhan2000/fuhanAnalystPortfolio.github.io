<!DOCTYPE HTML>
<!--
	Massively by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Scikit-learn Classification</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<a href="index.html" class=""></a>
					</header>

				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li><a href="index.html">Portfolio Main Page</a></li>

						</ul>
						<ul class="icons">
							<li><a href="https://www.linkedin.com/in/fuhhanchang/" class="icon brands alt fa-linkedin"><span class="label">linkedin</span></a></li>
							<li><a href="https://github.com/fuhan2000" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">

						<!-- Post -->
							<section class="post">
								<header class="major">
									
									<h1>Scikit-learn Classification <br />
										</h1>
									<p>We are trying to classify whether a bank customer will default on his loan.
									</p>
								</header>

								<div class="image main"><img src="images/unit13_ex4/unit13_ex4.png" alt="" /></div>
								<p>Prior to this, I have already run the dataset through SAP Predictive Analytics. The Predictive Power (KI) is 0.8585 and Prediction Confidence (KR) is 0.9611. 
								I will attempt to recreate this classification model in python using Random forest, Support vector machine and Neural network.</p>
								
								<h2>Most Influential Variables</h2>
								<p>As part of its AutoML process, SAP has decided that the following 16 variables have the most influence.</p>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/max_smart.png" alt=""></div></figure>
								<p><br/></p>
								<table style="width: 100%">
									<tr>
										<th>Column Name</th>
										<th>Description</th>
									</tr>
									<tr>
										<td>ACCOUNT_AGE</td>
										<td>Account Age in days</td>
									</tr>
									<tr>
										<td>ACCOUNT_DATE_DoY</td>
										<td>Day of the current year (1 to 366)</td>
									</tr>
									<tr>
										<td>AVERAGE_BALANCE_1M6B_AVG_0_BALANCE</td>
										<td>Average Balance for a period of 6 months before KxTimeStamp</td>
									</tr>
									<tr>
										<td>BIRTH_DATE_DoY</td>
										<td>Day of the birth date year</td>
									</tr>
									<tr>
										<td>CARD_AGE</td>
										<td>Card Age in days</td>
									</tr>
									<tr>
										<td>CARD_DATE_Y</td>
										<td>Card issue date</td>
									</tr>
									<tr>
										<td>CLIENT_AGE</td>
										<td>Client Age in years</td>
									</tr>
									<tr>
										<td>CLIENT_TYPE</td>
										<td>Internal classification use by Bank</td>
									</tr>
									<tr>
										<td>DISTRICT_NAME</td>
										<td>District Name as defined in CS_GEODEMO</td>
									</tr>
									<tr>
										<td>GEOCODE_ID</td>
										<td>District Code as defined in CS_GEODEMO</td>
									</tr>
									<tr>
										<td>LOAN_AMOUNT</td>
										<td>Loan amount issue to a customer</td>
									</tr>
									<tr>
										<td>LOAN_DATE_M</td>
										<td>Month of loan date</td>
									</tr>
									<tr>
										<td>LOAN_DATE_Y</td>
										<td>Year of loan date</td>
									</tr>
									<tr>
										<td>LOAN_PAYMENTS</td>
										<td>Payment value</td>
									</tr>
									<tr>
										<td>MIN_PAYMENT_1M6B_MIN_0_BALANCE</td>
										<td>Minimum payment amount over the past 6 months</td>
									</tr>
									<tr>
										<td>NUMBER_INHABITANTS</td>
										<td>Number of inhabitants as defined in CS_GEODEMO</td>
									</tr>
								</table>
								<p><br/></p>
								<h2>Import Libraries</h2>
								<blockquote>#Importing required packages.<br/>
									import pandas as pd<br/>
									import seaborn as sns<br/>
									import matplotlib.pyplot as plt<br/>
									from sklearn.ensemble import RandomForestClassifier<br/>
									from sklearn import svm<br/>
									from sklearn.neural_network import MLPClassifier<br/>
									from sklearn import linear_model<br/>
									#<br/>
									from sklearn.metrics import confusion_matrix, classification_report<br/>
									from sklearn.metrics import mean_squared_error, r2_score<br/>
									from sklearn.preprocessing import StandardScaler, LabelEncoder<br/>
									from sklearn.model_selection import train_test_split<br/>
									%matplotlib inline
								</blockquote>
								
								<h2>Inport data into data frame</h2>
								<blockquote>predict_df = pd.read_csv(r'E:\project\unit13_ex4_classify\unit13_ex4.csv')<br/>
									predict_df.head()</blockquote>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/df.png" alt=""></div></figure>
								<p><br/></p>
								<h2>Check for Nulls</h2>
								<blockquote># checking to see if there's any null variables<br/>
									# <br/>
									predict_df.isnull().sum().sort_values(ascending = False)</blockquote>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/null.png" alt=""></div></figure>
								<blockquote># fill all NaN with 0<br/>
									predict_df = predict_df.fillna(0)</blockquote>

								<h2>Check the label column</h2>
								<blockquote>sns.countplot(predict_df['TARGET'])</blockquote>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/count0.png" alt=""></div></figure>
								<blockquote># see how many 0 and 1 in TARGET column<br/>
									predict_df['TARGET'].value_counts()</blockquote>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/0and1.png" alt=""></div></figure>
								<p><br/></p>
								<h2>Change CLIENT_TYPE to numeric</h2>
								<blockquote>enc = LabelEncoder()<br/>
									enc.fit(predict_df['CLIENT_TYPE'])<br/>
									predict_df['CLIENT_TYPE'] = enc.transform(predict_df['CLIENT_TYPE'])<br/>
									predict_df['CLIENT_TYPE'].head()</blockquote>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/client_type.png" alt=""></div></figure>
								<p><br/></p>
								<h2>Change DISTRICT_NAME to numeric</h2>
								<blockquote>enc.fit(predict_df['DISTRICT_NAME'])<br/>
									predict_df['DISTRICT_NAME'] = enc.transform(predict_df['DISTRICT_NAME'])<br/>
									predict_df['DISTRICT_NAME'].head()
								</blockquote>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/district.png" alt=""></div></figure>
								<p><br/></p>
								<h2>Seperate the features and label</h2>
								<blockquote>
									# Now seperate the dataset as response variable and feature variabes<br/>
									# capital X <br/>
									# small y <br/>
									X = predict_df.drop(['KxId', 'KxTimeStamp','CLIENT_ID','ACCOUNT_ID', 'EST_ANNUAL_INCOME_1Y1B_SUM_0_AMOUNT','MAX_PAYMENT_1M6B_MAX_0_BALANCE',<br/>
									'AVERAGE_PAYMENT_1M6B_AVG_0_BALANCE','HOME_GEOCODE_ID', 'GENDER', 'BIRTH_DATE', 'BRANCHID', 'R','FREQUENCY', 'ACCOUNT_DATE', 'REGION_NAME',<br/>
									'NUMBER_CITIES_S', 'NUMBER_CITIES_M', 'NUMBER_CITIES_L', 'NUMBER_CITIES_XL','NUMBER_CITIES','URBAN_RATIO', 'AVERAGE_SALARY','UNEMP_RATE_2016', <br/>
									'UNEMP_RATE_2017','RATIO_ENTREPRENEURS', 'NUMBER_CRIMES_2016','NUMBER_CRIMES_2017', 'LOAN_ID', 'LOAN_DURATION', 'LOAN_STATUS', 'LOAN_DATE',
									'CARD_ID','CARD_TYPE','CARD_DATE',  'TARGET'], axis = 1)<br/>
								</blockquote>
								<blockquote>y = predict_df['TARGET']</blockquote>
								<blockquote># we will have 16 features<br/>
									X.shape</blockquote>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/16fea.png" alt=""></div></figure>
								<blockquote>#Train and Test splitting of data <br/>
									# test size is 20%<br/>
									X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.2, random_state = 42)<br/>
									# Applying Standard scaling to get optimized result<br/>
									# Need to normalize all our X<br/>
									#<br/>
									sc = StandardScaler()<br/>
									X_train = sc.fit_transform(X_train) <br/>
									X_test = sc.transform(X_test) <br/>
								</blockquote>

								<h2>Random forest classifier</h2>
								<blockquote># use 200 trees in the forest<br/>
								#<br/>
								rfc = RandomForestClassifier(n_estimators=200)<br/>
								# fit our training data<br/>
								rfc.fit(X_train, y_train)<br/>
								pred_rfc = rfc.predict(X_test)</blockquote>

								<Blockquote>#Let's see how our model performed<br/>
									# y_test is the actual value<br/>
									#<br/>
									# pred_rfc is the predicted value<br/>
									print(classification_report(y_test, pred_rfc))</Blockquote>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/rfc_cr.png" alt=""></div></figure>
								<p>Precision(1): precision in determining customer who default: 100%. We have high precision and recall. In ML, we want high precision and recall as it means we have
									highly accurate model.
								</p>

								<blockquote>#Confusion matrix for the random forest classification<br/>
								# sklearn.metrics.confusion_matrix(y_true, y_pred)<br/>
								cf_matrix = confusion_matrix(y_test, pred_rfc)<br/>
								tn, fp, fn, tp = cf_matrix.ravel()<br/>
								tn, fp, fn, tp</blockquote>
								<p>(737, 0, 14, 76)</p><br/>
								<p>TP=76, TN=737. This compare with SAP TP = 43, TN= 700.</p>
								<blockquote># sklearn.metrics.accuracy_score(y_true, y_pred)<br/>
									from sklearn.metrics import accuracy_score<br/>
									myac_rfc = accuracy_score(y_test, pred_rfc)<br/>
									myac_rfc</blockquote>
								<p>0.9830713422007256</p><br/>
								<p>The accuracy score is 98.3%.</p>

								<h2>SVM</h2>

								<blockquote>clf=svm.SVC()<br/>
									clf.fit(X_train, y_train)<br/>
									pred_clf = clf.predict(X_test)<br/>
									print(classification_report(y_test, pred_clf))
								</blockquote>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/svm_cr.png" alt=""></div></figure>
								<p>A precision(1) and recall(1) of 0% look suspicious.</p>
								<blockquote>
									cf_matrix_svm = confusion_matrix(y_test, pred_clf)<br/>
									tn, fp, fn, tp = cf_matrix_svm.ravel()<br/>
									tn, fp, fn, tp
								</blockquote>
								<p>(737, 0, 90, 0)</p>
								<blockquote>myac_svm = accuracy_score(y_test,pred_clf )<br/>
									myac_svm</blockquote>
								<p>0.8911729141475212</p>

								<h2>Neural Network</h2>
								<blockquote># NN Multi-layer Perceptron classifier<br/>
									# we will have three layers.<br/>
									# each layer has 11 nodes<br/>
									mlpc = MLPClassifier(hidden_layer_sizes=(11,11,11), max_iter=5000)<br/>
									mlpc.fit(X_train, y_train)<br/>
									pred_mlpc = mlpc.predict(X_test)</blockquote>
								
								<blockquote>print(classification_report(y_test, pred_mlpc ))</blockquote>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/nn_cr.png" alt=""></div></figure>
								<blockquote>cf_matrix_nn = confusion_matrix(y_test, pred_mlpc)<br/>
									tn, fp, fn, tp = cf_matrix_nn.ravel()<br/>
									tn, fp, fn, tp</blockquote>
								<p>(717, 20, 33, 57)</p>
								<p>TN=717, TP = 57</p>
								<blockquote>myac_NN = accuracy_score(y_test, pred_mlpc)<br/>
									myac_NN</blockquote>
								<p>0.9359129383313181</p>
								<p>Neural network has an accuracy of 93.6%.</p>
								<h2>SAP model</h2>
								<figure style="max-width:2388pxpx" class="w-richtext-align-fullwidth w-richtext-figure-type-image"><div><img src="images/unit13_ex4/sap_conf.png" alt=""></div></figure>
								<p>SAP has an overall accuracy of 89.86%. Neural network TP and TN are 57 and 717 respectively. SAP's TP and TN are 43 and 700 respectively. The figures can be 
									compared directly as the test sample size is the same at 827. I have double-checked there are no typo errors and leaker variables in the SVM model. I suspect SAP AutoML process 
									also detected unusual result in SVM and rejected it. I have done similar SVM models on different dataset and did not face similar issue.</p>
								<p>AutoML is great except that in this case, it does not tell me which classfication algorithm it is using. </p>

								<h2>Conclusion</h2>
								I may have to dig deeper into the various algorithms to discover the truth. But for now the SAP model is good enough to deploy as its KI and KR values are good
								at 0.8585 and 0.9611 respectively. 

							</section>

					</div>

				<!-- Footer -->
					<footer id="footer">
						<nav id="nav">
							<ul class="links">
								<li><a href="index.html">Portfolio Main Page</a></li>
	
							</ul>
						</nav>

						<section class="split contact">




						</section>
					</footer>

				<!-- Copyright -->
					<div id="copyright">
						<ul><li>&copy; fuhan</li></ul>
					</div>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>